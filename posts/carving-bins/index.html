<!DOCTYPE html>
<html lang="en-us">
	<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="The radare team">
<meta name="description" content="The blog of radare2">
<meta name="generator" content="Hugo 0.74.3" />
<title>Carving bins</title>
<link rel="shortcut icon" href="https://radareorg.github.io/blog/images/favicon.ico">
<link rel="stylesheet" href="https://radareorg.github.io/blog/css/style.css">
<link rel="stylesheet" href="https://radareorg.github.io/blog/css/highlight.css">



<link rel="stylesheet" href="https://radareorg.github.io/blog/css/monosocialiconsfont.css">



<link href="https://radareorg.github.io/blog/index.xml" rel="alternate" type="application/rss+xml" title="The Official Radare Blog" />


<meta property="og:title" content="Carving bins" />
<meta property="og:description" content="Radare was initially developed as a forensic tool. Nowadays most people use it for static code analysis or binary patching, but the framework and the tools still provide functionalities for analyzing disk partitions or filesystems..
In this post I&rsquo;m going to explain how to use r2 to extract some ELFs files from a raw memory dump or unknown format firmware image.
This kind of search is called &lsquo;carving&rsquo; and there are already several tools that can do this automatically for free." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://radareorg.github.io/blog/posts/carving-bins/" />
<meta property="article:published_time" content="2014-06-20T17:36:23+02:00" />
<meta property="article:modified_time" content="2014-06-20T17:36:23+02:00" />


<meta itemprop="name" content="Carving bins">
<meta itemprop="description" content="Radare was initially developed as a forensic tool. Nowadays most people use it for static code analysis or binary patching, but the framework and the tools still provide functionalities for analyzing disk partitions or filesystems..
In this post I&rsquo;m going to explain how to use r2 to extract some ELFs files from a raw memory dump or unknown format firmware image.
This kind of search is called &lsquo;carving&rsquo; and there are already several tools that can do this automatically for free.">
<meta itemprop="datePublished" content="2014-06-20T17:36:23+02:00" />
<meta itemprop="dateModified" content="2014-06-20T17:36:23+02:00" />
<meta itemprop="wordCount" content="476">



<meta itemprop="keywords" content="" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Carving bins"/>
<meta name="twitter:description" content="Radare was initially developed as a forensic tool. Nowadays most people use it for static code analysis or binary patching, but the framework and the tools still provide functionalities for analyzing disk partitions or filesystems..
In this post I&rsquo;m going to explain how to use r2 to extract some ELFs files from a raw memory dump or unknown format firmware image.
This kind of search is called &lsquo;carving&rsquo; and there are already several tools that can do this automatically for free."/>


    </head>
<body>
    <nav class="main-nav">
	
		<a href='https://radareorg.github.io/blog'> <span class="arrow">‚Üê</span>Home</a>
	

	

	
		<a class="cta" href="https://radareorg.github.io/blog/index.xml">Subscribe</a>
	
</nav>

    <section id="wrapper">
        
        
<article class="post">
    <header>
        <h1>Carving bins</h1>
        <h2 class="subtitle"></h2>
        <h2 class="headline">
        June 20, 2014
        <br>
        
        </h2>
    </header>
    <section id="post-body">
        <p>Radare was initially developed as a forensic tool. Nowadays most people use it for static code analysis or binary patching, but the framework and the tools still provide functionalities for analyzing disk partitions or filesystems..</p>
<p>In this post I&rsquo;m going to explain how to use r2 to extract some ELFs files from a raw memory dump or unknown format firmware image.</p>
<p>This kind of search is called &lsquo;carving&rsquo; and there are already several tools that can do this automatically for free.</p>
<ul>
<li><a href="http://www.cgsecurity.org/wiki/PhotoRec">photorec</a></li>
<li><a href="https://github.com/sleuthkit/scalpel">scalpel</a></li>
<li><a href="http://binwalk.org/">binwalk</a></li>
<li>&hellip;</li>
</ul>
<p>But this is not the place to talk about them. Let&rsquo;s open an r2 shell!</p>
<h2 id="searching-the-needle">Searching the needle</h2>
<pre><code>$ r2 -n dump.bin
</code></pre>
<p>At this point we will get the r2 prompt opening the file without trying to understand its format (-n) at the offset 0. We want to search for ELF files, and the &lsquo;/&rsquo; command can do this search and store the results in flags.</p>
<pre><code>[0x00000000]&gt; / \x7fELF
Searching 4 bytes from 0x00000000 to 0x0000002d: 7f 45 4c 46
0x00001340 hit0_0
0x00001744 hit0_1
...
</code></pre>
<p>On every match we will get a flag pointing to the begining of the ELF files. We can then dump them all to disk with that oneliner:</p>
<pre><code>[0x00000000]&gt; b 1M
[0x00000000]&gt; wt @@ hit0*
</code></pre>
<p>Note that &lsquo;wt&rsquo; will require an argument (filename) if you are not using the latest version from git. This simplifies the process of naming every dumped portion.</p>
<p>We set the blocksize to 1MB because we don&rsquo;t expect to have bigger executables, but you may change this depending on your target.</p>
<p>Once we have dumped every ELF hit we may like to run rabin2 on them to identify the real size of the original executable by analyzing the file heaers. You can do this with <code>rabin2 -Z</code></p>
<pre><code>$ for a in dump.* ; do
sz=`rabin2 -Z $a`     # get RBin.filesize
r2 -wnqc&quot;r $sz&quot; $a  # resize file
done
</code></pre>
<p>This shellscript loop will truncate all the dumped files to the file size reported by RBin.</p>
<h2 id="looking-for-some-magic">Looking for some magic</h2>
<p>Another way for carving for known filetypes on memory is by using the <code>libmagic</code> functionality, while we ship a slightly modified code from OpenBSD.</p>
<p>The magic database has been shrinked to just contain the most common filetypes (to speedup search), but you may write or change that magic database to do your own searches and display some header information on every hit.</p>
<pre><code>/m [magicfile]
</code></pre>
<p>The Yara plugin is also distributed with r2. It can be used as a replacement for libmagic and it&rsquo;s already being used for detecting file signatures to determine compiler types, shellcodes, protections and more.</p>
<p>Install latest yara and run <code>:yara scan</code> in your r2 shell.</p>
<h2 id="final-words">Final words</h2>
<p>As long as the IO layer is pluggable, r2 is able to perform those search&amp;dump operations on process memory when attaching the debugger, raw hard disk image, remote files (rap, gdb..), and much more.</p>

    </section>
</article>

<footer id="post-meta" class="clearfix">
    <a href="https://twitter.com/radareorg">
    <img class="avatar" src="https://radareorg.github.io/blog/images/avatar.png">
    <div>
        <span class="dark">The radare team</span>
        <span></span>
    </div>
    </a>
    <section id="sharing">
        <a class="twitter" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fradareorg.github.io%2fblog%2fposts%2fcarving-bins%2f - Carving%20bins by @radareorg"><span class="icon-twitter"> https://twitter.com/radareorg</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

    </section>
</footer>



<ul id="post-list" class="archive readmore">
    <h3>Read more</h3>

    
    
    
        <li>
            <a href="https://radareorg.github.io/blog/posts/sleigh_disassembler_backend/">GSoC 2020: SLEIGH Disassembler Backend<aside class="dates">Sep 6 2020</aside></a>
        </li>
    
        <li>
            <a href="https://radareorg.github.io/blog/posts/rsoc-2019-console-interface-improvement/">RSoC 2019 Final: Console Interface Improvements<aside class="dates">Oct 1 2019</aside></a>
        </li>
    
        <li>
            <a href="https://radareorg.github.io/blog/posts/rsoc-2019-selection/">Radare2 Summer of Code 2019 Selection Results<aside class="dates">Apr 2 2019</aside></a>
        </li>
    
        <li>
            <a href="https://radareorg.github.io/blog/posts/radare2-survey/">Radare2 Community Survey Results<aside class="dates">Feb 2 2019</aside></a>
        </li>
    
        <li>
            <a href="https://radareorg.github.io/blog/posts/radare2-bioinformatics/">Radare2 and bioinformatics: a good match?<aside class="dates">Aug 31 2018</aside></a>
        </li>
    
        <li>
            <a href="https://radareorg.github.io/blog/posts/cutter_debug/">GSoC 2018 Final: Debugging and Emulation Support for Cutter<aside class="dates">Aug 20 2018</aside></a>
        </li>
    
        <li>
            <a href="https://radareorg.github.io/blog/posts/cli_improvements/">GSoC 2018 Final: Console Interface Improvementes<aside class="dates">Aug 19 2018</aside></a>
        </li>
    
        <li>
            <a href="https://radareorg.github.io/blog/posts/gsoc_2018_radeco_cfs/">GSoC 2018: Control Flow Structuring for Radeco-lib<aside class="dates">Aug 12 2018</aside></a>
        </li>
    
        <li>
            <a href="https://radareorg.github.io/blog/posts/gsoc_2018_radeco_pseudo_c_code_generation/">Gsoc 2018 Radeco Pseudo C Code Generation<aside class="dates">Aug 12 2018</aside></a>
        </li>
    
        <li>
            <a href="https://radareorg.github.io/blog/posts/type_inference/">GSoC&#39;18 Final: Type inference<aside class="dates">Aug 12 2018</aside></a>
        </li>
    
</ul>



        <footer id="footer">
    
    <p class="small">
    
        The radare team
    
    </p>
</footer>

    </section>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://radareorg.github.io/blog/js/main.js"></script>
<script src="https://radareorg.github.io/blog/js/highlight.js"></script>
<script>hljs.initHighlightingOnLoad();</script>





</body>
</html>
